import{s as safe_not_equal,n as noop,f as subscribe,h as get_store_value,o as onMount,b as binding_callbacks,r as run_all,e as component_subscribe,i as null_to_empty}from"../chunks/scheduler.918d31b8.js";import{S as SvelteComponent,i as init,g as element,s as space,h as claim_element,j as children,y as get_svelte_dataset,c as claim_space,f as detach,k as attr,a as insert_hydration,x as append_hydration,z as listen,m as text,n as claim_text,o as set_data,e as empty,H as HtmlTagHydration,A as claim_html_tag,l as set_style,d as transition_in,p as group_outros,t as transition_out,b as check_outros,r as create_component,u as claim_component,v as mount_component,w as destroy_component}from"../chunks/index.94a51986.js";import{g as getNode,d as deleteNode,u as useserver,o as openaikey,c as createNode,p as primer,a as context_message_number}from"../chunks/store.e325e8e8.js";import{w as writable}from"../chunks/index.c018a9c8.js";import"../chunks/paths.50c8d5ff.js";const staticMessage_svelte_svelte_type_style_lang="";function create_else_block_1(l){let e,t,n,a="error243",s,i=l[1].content+"",o;return{c(){e=element("div"),t=element("div"),n=element("h2"),n.textContent=a,s=space(),o=text(i),this.h()},l(_){e=claim_element(_,"DIV",{});var d=children(e);t=claim_element(d,"DIV",{class:!0});var c=children(t);n=claim_element(c,"H2",{"data-svelte-h":!0}),get_svelte_dataset(n)!=="svelte-1donvxb"&&(n.textContent=a),s=claim_space(c),o=claim_text(c,i),c.forEach(detach),d.forEach(detach),this.h()},h(){attr(t,"class","msg svelte-1phlzee")},m(_,d){insert_hydration(_,e,d),append_hydration(e,t),append_hydration(t,n),append_hydration(t,s),append_hydration(t,o)},p(_,d){d&2&&i!==(i=_[1].content+"")&&set_data(o,i)},d(_){_&&detach(e)}}}function create_if_block_3$1(l){var s;let e,t,n=((s=l[5])==null?void 0:s.content)+"",a;return{c(){e=element("div"),t=element("div"),a=text(n),this.h()},l(i){e=claim_element(i,"DIV",{class:!0});var o=children(e);t=claim_element(o,"DIV",{class:!0});var _=children(t);a=claim_text(_,n),_.forEach(detach),o.forEach(detach),this.h()},h(){attr(t,"class","msg svelte-1phlzee"),attr(e,"class","function svelte-1phlzee")},m(i,o){insert_hydration(i,e,o),append_hydration(e,t),append_hydration(t,a)},p(i,o){var _;o&32&&n!==(n=((_=i[5])==null?void 0:_.content)+"")&&set_data(a,n)},d(i){i&&detach(e)}}}function create_if_block$2(l){let e;function t(s,i){return s[4]?create_if_block_1$1:create_else_block$1}let n=t(l),a=n(l);return{c(){a.c(),e=empty()},l(s){a.l(s),e=empty()},m(s,i){a.m(s,i),insert_hydration(s,e,i)},p(s,i){n===(n=t(s))&&a?a.p(s,i):(a.d(1),a=n(s),a&&(a.c(),a.m(e.parentNode,e)))},d(s){s&&detach(e),a.d(s)}}}function create_else_block$1(l){let e,t,n,a=tohtml$1(l[1].content)+"";return{c(){e=element("div"),t=element("div"),n=new HtmlTagHydration(!1),this.h()},l(s){e=claim_element(s,"DIV",{class:!0});var i=children(e);t=claim_element(i,"DIV",{class:!0});var o=children(t);n=claim_html_tag(o,!1),o.forEach(detach),i.forEach(detach),this.h()},h(){n.a=null,attr(t,"class","msg svelte-1phlzee"),attr(e,"class","assistant svelte-1phlzee")},m(s,i){insert_hydration(s,e,i),append_hydration(e,t),n.m(a,t)},p(s,i){i&2&&a!==(a=tohtml$1(s[1].content)+"")&&n.p(a)},d(s){s&&detach(e)}}}function create_if_block_1$1(l){let e,t,n,a=l[6]?"v":">",s,i,o=l[4].function_call.name+"",_,d,c,m,r=l[6]&&create_if_block_2$1(l);return{c(){e=element("div"),t=element("div"),n=element("button"),s=text(a),i=space(),_=text(o),d=space(),r&&r.c(),this.h()},l(u){e=claim_element(u,"DIV",{class:!0});var h=children(e);t=claim_element(h,"DIV",{class:!0});var p=children(t);n=claim_element(p,"BUTTON",{class:!0});var g=children(n);s=claim_text(g,a),i=claim_space(g),_=claim_text(g,o),g.forEach(detach),d=claim_space(p),r&&r.l(p),p.forEach(detach),h.forEach(detach),this.h()},h(){attr(n,"class","function_title svelte-1phlzee"),attr(t,"class","msg svelte-1phlzee"),attr(e,"class","assistant svelte-1phlzee")},m(u,h){insert_hydration(u,e,h),append_hydration(e,t),append_hydration(t,n),append_hydration(n,s),append_hydration(n,i),append_hydration(n,_),append_hydration(t,d),r&&r.m(t,null),c||(m=listen(n,"click",l[7]),c=!0)},p(u,h){h&64&&a!==(a=u[6]?"v":">")&&set_data(s,a),h&16&&o!==(o=u[4].function_call.name+"")&&set_data(_,o),u[6]?r?r.p(u,h):(r=create_if_block_2$1(u),r.c(),r.m(t,null)):r&&(r.d(1),r=null)},d(u){u&&detach(e),r&&r.d(),c=!1,m()}}}function create_if_block_2$1(l){let e,t=format_function_arguments(l[4].function_call.arguments)+"",n;return{c(){e=element("div"),n=text(t),this.h()},l(a){e=claim_element(a,"DIV",{style:!0});var s=children(e);n=claim_text(s,t),s.forEach(detach),this.h()},h(){set_style(e,"margin-top","1em")},m(a,s){insert_hydration(a,e,s),append_hydration(e,n)},p(a,s){s&16&&t!==(t=format_function_arguments(a[4].function_call.arguments)+"")&&set_data(n,t)},d(a){a&&detach(e)}}}function create_fragment$3(l){let e,t,n=" ",a,s,i,o="x",_,d;function c(u,h){return u[2].message.role=="assistant"?create_if_block$2:u[1].role=="function"?create_if_block_3$1:create_else_block_1}let m=c(l),r=m(l);return{c(){e=element("div"),t=element("button"),t.textContent=n,a=space(),r.c(),s=space(),i=element("button"),i.textContent=o,this.h()},l(u){e=claim_element(u,"DIV",{class:!0});var h=children(e);t=claim_element(h,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(t)!=="svelte-2nj3z4"&&(t.textContent=n),a=claim_space(h),r.l(h),s=claim_space(h),i=claim_element(h,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(i)!=="svelte-1fkcjn"&&(i.textContent=o),h.forEach(detach),this.h()},h(){attr(t,"class","svelte-1phlzee"),attr(i,"class","active svelte-1phlzee"),attr(e,"class","bubble svelte-1phlzee")},m(u,h){insert_hydration(u,e,h),append_hydration(e,t),append_hydration(e,a),r.m(e,null),append_hydration(e,s),append_hydration(e,i),_||(d=listen(i,"click",l[8]),_=!0)},p(u,[h]){m===(m=c(u))&&r?r.p(u,h):(r.d(1),r=m(u),r&&(r.c(),r.m(e,s)))},i:noop,o:noop,d(u){u&&detach(e),r.d(),_=!1,d()}}}function tohtml$1(l){if(l==null)return"";let e=l.replaceAll("<","&lt;").replace(/\n/g,"<br>");for(var t=0;;){let n=e.indexOf("```",t);if(n==-1)break;let a=e.indexOf("<br>",n+1),s=e.substring(n+3,a);if(t=e.indexOf("```",a),t==-1)break;let i=e.substring(a+4,t);i.replaceAll('"','\\"').replaceAll("<br>",`
`);let o=`<pre class="codeblock"><div> ${s} </div>`+i+"</pre>";e=e.substring(0,n)+o+e.substring(t+3)}return e}function format_function_arguments(l){try{let e=JSON.parse(l);return e.argument?e.argument:l}catch{return l}}function instance$3(l,e,t){let n,a=noop,s=()=>(a(),a=subscribe(o,h=>t(2,n=h)),o);l.$$.on_destroy.push(()=>a());let{id:i}=e,o=getNode(i);if(s(),n.message.role=="user")throw new Error("userMessage can only be used for user messages");let _=n.message,d=null,c=null;_.function_call&&(d=_),_.name&&(c=_);let m=!1;const r=()=>{t(6,m=!m)},u=()=>{deleteNode(i)};return l.$$set=h=>{"id"in h&&t(0,i=h.id)},l.$$.update=()=>{l.$$.dirty&7&&(s(t(3,o=getNode(i))),t(1,_=n.message),_.function_call?t(4,d=_):t(4,d=null),_.name?t(5,c=_):t(5,c=null))},[i,_,n,o,d,c,m,r,u]}class StaticMessage extends SvelteComponent{constructor(e){super(),init(this,e,instance$3,create_fragment$3,safe_not_equal,{id:0})}}async function chat_stream_request(l,e){return(await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},body:JSON.stringify({model:"gpt-3.5-turbo",messages:l.messages,temperature:l.temperature??.7,functions:[{name:"eval",description:"Use this function to evaluate any javascript code. It can fetch information from the internet.",parameters:{type:"object",properties:{argument:{type:"string",description:"javascript code to evaluate"}},required:["argument"]}}],function_call:"auto",stream:!0})})).body}async function chatCompletion(l,e){let t;if(get_store_value(useserver)){let s=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(s.body==null){console.error("failed to get response stream");return}if(s.body==null){console.error("failed to get response stream");return}t=s.body.getReader()}else t=(await chat_stream_request(l,get_store_value(openaikey))).getReader();let n=new TextDecoder,a=!1;for(;!a;){const{value:s,done:i}=await t.read();a=i,n.decode(s).split(`
`).filter(d=>d.length>0).forEach(d=>{if(d=="data: [DONE]")return;if(!d.startsWith("data:"))throw console.error("unexpected response",d),new Error("unexpected response");let c=JSON.parse(d.slice(6));if(c.choices[0].delta.content)e.update(m=>(m.content+=c.choices[0].delta.content,m));else if(c.choices[0].delta.function_call){let m=c.choices[0].delta.function_call;m.name?e.update(r=>(r.function_call=m,r)):e.update(r=>(r.function_call.arguments+=m.arguments,r))}})}}const dynamicMessage_svelte_svelte_type_style_lang="";function create_else_block(l){let e,t;return{c(){e=element("div"),t=element("div"),this.h()},l(n){e=claim_element(n,"DIV",{class:!0});var a=children(e);t=claim_element(a,"DIV",{class:!0}),children(t).forEach(detach),a.forEach(detach),this.h()},h(){attr(t,"class","msg svelte-z15wxn"),attr(e,"class","assistant svelte-z15wxn")},m(n,a){insert_hydration(n,e,a),append_hydration(e,t),l[13](t)},p:noop,d(n){n&&detach(e),l[13](null)}}}function create_if_block$1(l){let e,t,n,a,s="x",i,o;return{c(){e=element("div"),t=element("div"),n=space(),a=element("button"),a.textContent=s,this.h()},l(_){e=claim_element(_,"DIV",{class:!0});var d=children(e);t=claim_element(d,"DIV",{contenteditable:!0,class:!0}),children(t).forEach(detach),n=claim_space(d),a=claim_element(d,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(a)!=="svelte-1n9arnn"&&(a.textContent=s),d.forEach(detach),this.h()},h(){attr(t,"contenteditable",""),attr(t,"class","msg svelte-z15wxn"),attr(a,"class","active svelte-z15wxn"),attr(e,"class","user svelte-z15wxn")},m(_,d){insert_hydration(_,e,d),append_hydration(e,t),l[11](t),append_hydration(e,n),append_hydration(e,a),i||(o=[listen(t,"keypress",l[4]),listen(t,"keyup",l[6]),listen(t,"keydown",l[5]),listen(t,"input",l[7]),listen(t,"paste",onpaste),listen(a,"click",l[12])],i=!0)},p:noop,d(_){_&&detach(e),l[11](null),i=!1,run_all(o)}}}function create_fragment$2(l){let e,t,n=" ",a,s,i,o="x",_,d;function c(u,h){return u[2].message.role=="user"?create_if_block$1:create_else_block}let m=c(l),r=m(l);return{c(){e=element("div"),t=element("button"),t.textContent=n,a=space(),r.c(),s=space(),i=element("button"),i.textContent=o,this.h()},l(u){e=claim_element(u,"DIV",{class:!0});var h=children(e);t=claim_element(h,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(t)!=="svelte-2nj3z4"&&(t.textContent=n),a=claim_space(h),r.l(h),s=claim_space(h),i=claim_element(h,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(i)!=="svelte-1fkcjn"&&(i.textContent=o),h.forEach(detach),this.h()},h(){attr(t,"class","svelte-z15wxn"),attr(i,"class","active svelte-z15wxn"),attr(e,"class","bubble svelte-z15wxn")},m(u,h){insert_hydration(u,e,h),append_hydration(e,t),append_hydration(e,a),r.m(e,null),append_hydration(e,s),append_hydration(e,i),_||(d=listen(i,"click",l[14]),_=!0)},p(u,[h]){m===(m=c(u))&&r?r.p(u,h):(r.d(1),r=m(u),r&&(r.c(),r.m(e,s)))},i:noop,o:noop,d(u){u&&detach(e),r.d(),_=!1,d()}}}function tohtml(l){let e=l.replaceAll("<","&lt;").replace(/\n/g,"<br>");for(var t=0;;){let n=e.indexOf("```",t);if(n==-1)break;let a=e.indexOf("<br>",n+1),s=e.substring(n+3,a);if(t=e.indexOf("```",a),t==-1)break;let i=e.substring(a+4,t),o=i.replaceAll('"','\\"').replaceAll("<br>",`
`),_=`<pre class="codeblock"><div> ${s} <button onclick='navigator.clipboard.writeText(\`${o}\`)'>copy</button> </div>`+i+"</pre>";e=e.substring(0,n)+_+e.substring(t+3)}return e}function totext(l){return l.replace(/<br>/g,`
`)}function cleanMarkup(l){let e=document.createElement("textarea");return e.innerHTML=l,e.remove(),e.value}function onpaste(l){var t;l.preventDefault(),console.log("paste");let e=(t=l.clipboardData)==null?void 0:t.getData("text/plain");e&&document.execCommand("insertText",!1,e)}function instance$2(l,e,t){let n,a=noop,s=()=>(a(),a=subscribe(d,f=>t(2,n=f)),d);l.$$.on_destroy.push(()=>a());let{id:i}=e,o=i,{sendMessage:_}=e,d=getNode(i);s();let c;onMount(()=>{t(1,c.innerHTML=tohtml(n.message.content),c)});let m=!1;function r(f){f.key=="Enter"&&!m&&(f.preventDefault(),_())}function u(f){f.key=="Shift"&&(m=!0)}function h(f){f.key=="Shift"&&(m=!1)}function p(f){let b=totext(c.innerHTML),N=n.message.content;n.children.length>0?(createNode({role:"user",content:b},n.parent),t(1,c.innerHTML=tohtml(N),c),console.log("create new node",b)):d.update(v=>(v.message.content=b,v))}function g(f){binding_callbacks[f?"unshift":"push"](()=>{c=f,t(1,c),t(0,i),t(10,o),t(2,n)})}const y=()=>{deleteNode(i)};function k(f){binding_callbacks[f?"unshift":"push"](()=>{c=f,t(1,c),t(0,i),t(10,o),t(2,n)})}const $=()=>{deleteNode(i)};return l.$$set=f=>{"id"in f&&t(0,i=f.id),"sendMessage"in f&&t(8,_=f.sendMessage)},l.$$.update=()=>{l.$$.dirty&1031&&(s(t(3,d=getNode(i))),c&&o!=i&&(t(1,c.innerHTML=tohtml(n.message.content),c),t(10,o=i),c.focus()))},[i,c,n,d,r,u,h,p,_,cleanMarkup,o,g,y,k,$]}class DynamicMessage extends SvelteComponent{constructor(e){super(),init(this,e,instance$2,create_fragment$2,safe_not_equal,{id:0,sendMessage:8,cleanMarkup:9})}get cleanMarkup(){return cleanMarkup}}const chatNode_svelte_svelte_type_style_lang="";function create_if_block(l){let e,t,n,a,s;const i=[create_if_block_3,create_if_block_4],o=[];function _(c,m){return c[1].message.role=="user"?0:c[1].message.role!="system"?1:-1}~(e=_(l))&&(t=o[e]=i[e](l));let d=l[1].children.length>0&&create_if_block_1(l);return{c(){t&&t.c(),n=space(),d&&d.c(),a=empty()},l(c){t&&t.l(c),n=claim_space(c),d&&d.l(c),a=empty()},m(c,m){~e&&o[e].m(c,m),insert_hydration(c,n,m),d&&d.m(c,m),insert_hydration(c,a,m),s=!0},p(c,m){let r=e;e=_(c),e===r?~e&&o[e].p(c,m):(t&&(group_outros(),transition_out(o[r],1,1,()=>{o[r]=null}),check_outros()),~e?(t=o[e],t?t.p(c,m):(t=o[e]=i[e](c),t.c()),transition_in(t,1),t.m(n.parentNode,n)):t=null),c[1].children.length>0?d?(d.p(c,m),m&2&&transition_in(d,1)):(d=create_if_block_1(c),d.c(),transition_in(d,1),d.m(a.parentNode,a)):d&&(group_outros(),transition_out(d,1,1,()=>{d=null}),check_outros())},i(c){s||(transition_in(t),transition_in(d),s=!0)},o(c){transition_out(t),transition_out(d),s=!1},d(c){c&&(detach(n),detach(a)),~e&&o[e].d(c),d&&d.d(c)}}}function create_if_block_4(l){let e,t;return e=new StaticMessage({props:{id:l[0]}}),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,a){mount_component(e,n,a),t=!0},p(n,a){const s={};a&1&&(s.id=n[0]),e.$set(s)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}function create_if_block_3(l){let e,t;return e=new DynamicMessage({props:{id:l[0],sendMessage:l[4]}}),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,a){mount_component(e,n,a),t=!0},p(n,a){const s={};a&1&&(s.id=n[0]),e.$set(s)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}function create_if_block_1(l){let e,t,n,a,s=l[1].message.role!="system"&&create_if_block_2(l);return n=new ChatNode({props:{nodeId:l[1].children[l[3]]}}),{c(){s&&s.c(),e=space(),t=element("div"),create_component(n.$$.fragment)},l(i){s&&s.l(i),e=claim_space(i),t=claim_element(i,"DIV",{});var o=children(t);claim_component(n.$$.fragment,o),o.forEach(detach)},m(i,o){s&&s.m(i,o),insert_hydration(i,e,o),insert_hydration(i,t,o),mount_component(n,t,null),a=!0},p(i,o){i[1].message.role!="system"?s?s.p(i,o):(s=create_if_block_2(i),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null);const _={};o&10&&(_.nodeId=i[1].children[i[3]]),n.$set(_)},i(i){a||(transition_in(n.$$.fragment,i),a=!0)},o(i){transition_out(n.$$.fragment,i),a=!1},d(i){i&&(detach(e),detach(t)),s&&s.d(i),destroy_component(n)}}}function create_if_block_2(l){let e,t,n,a,s,i,o,_,d,c;return{c(){e=element("div"),t=element("button"),n=text("<"),s=space(),i=element("button"),o=text(">"),this.h()},l(m){e=claim_element(m,"DIV",{class:!0});var r=children(e);t=claim_element(r,"BUTTON",{class:!0});var u=children(t);n=claim_text(u,"<"),u.forEach(detach),s=claim_space(r),i=claim_element(r,"BUTTON",{class:!0});var h=children(i);o=claim_text(h,">"),h.forEach(detach),r.forEach(detach),this.h()},h(){attr(t,"class",a=null_to_empty(l[3]>0?"active":"hidden")+" svelte-1usy634"),attr(i,"class",_=null_to_empty(l[1].children.length>l[3]+1?"active":"hidden")+" svelte-1usy634"),attr(e,"class","navbar svelte-1usy634")},m(m,r){insert_hydration(m,e,r),append_hydration(e,t),append_hydration(t,n),append_hydration(e,s),append_hydration(e,i),append_hydration(i,o),d||(c=[listen(t,"click",l[6]),listen(i,"click",l[7])],d=!0)},p(m,r){r&8&&a!==(a=null_to_empty(m[3]>0?"active":"hidden")+" svelte-1usy634")&&attr(t,"class",a),r&10&&_!==(_=null_to_empty(m[1].children.length>m[3]+1?"active":"hidden")+" svelte-1usy634")&&attr(i,"class",_)},d(m){m&&detach(e),d=!1,run_all(c)}}}function create_fragment$1(l){let e,t,n=l[1]&&create_if_block(l);return{c(){n&&n.c(),e=empty()},l(a){n&&n.l(a),e=empty()},m(a,s){n&&n.m(a,s),insert_hydration(a,e,s),t=!0},p(a,[s]){a[1]?n?(n.p(a,s),s&2&&transition_in(n,1)):(n=create_if_block(a),n.c(),transition_in(n,1),n.m(e.parentNode,e)):n&&(group_outros(),transition_out(n,1,1,()=>{n=null}),check_outros())},i(a){t||(transition_in(n),t=!0)},o(a){transition_out(n),t=!1},d(a){a&&detach(e),n&&n.d(a)}}}function instance$1($$self,$$props,$$invalidate){let $primer,$context_message_number,$node,$$unsubscribe_node=noop,$$subscribe_node=()=>($$unsubscribe_node(),$$unsubscribe_node=subscribe(node,l=>$$invalidate(1,$node=l)),node);component_subscribe($$self,primer,l=>$$invalidate(9,$primer=l)),component_subscribe($$self,context_message_number,l=>$$invalidate(10,$context_message_number=l)),$$self.$$.on_destroy.push(()=>$$unsubscribe_node());let{nodeId}=$$props,node=getNode(nodeId);$$subscribe_node();let old_child_count=$node?$node.children.length:0;var oldid=nodeId;let openchild=0;function get_history(){let l=[$node.message],e=$node.parent;for(;e!=null&&l.length<$context_message_number;){let t=getNode(e);l=[get_store_value(t).message,...l],e=get_store_value(t).parent}return l=[$primer.message,...l],console.log(l),l}async function send(){let hist=get_history();console.log({hist});let childid=createNode({role:"assistant",content:""},nodeId),child=getNode(childid),message=writable(get_store_value(child).message);if(message.subscribe(l=>{child.update(e=>({...e,message:l}))}),await chatCompletion({messages:hist},message),get_store_value(message).function_call){let fcall=get_store_value(message).function_call;if((fcall==null?void 0:fcall.name)=="eval"){let res,res_string="";childid=createNode({role:"function",name:"eval",content:res_string},childid);let function_node=getNode(childid);try{let conslog=function(...l){res_string+=l+`
`,console.log(res_string),console.log(child),function_node.update(e=>({...e,message:{...e.message,content:res_string}}))},call=JSON.parse(fcall.arguments),code=call.argument.replaceAll("console.log","conslog");res=eval(code),res instanceof Promise&&(console.log("awaiting promise"),res=await res,res_string+=JSON.stringify(res)),console.log(res),res_string+=JSON.stringify(res)??"",function_node.update(l=>({...l,message:{...l.message,content:res_string}}))}catch(l){console.log(l),console.log(fcall.arguments);let e=String(l);console.log(e),res_string+=e,function_node.update(t=>({...t,message:{...t.message,content:res_string}}))}}}createNode({role:"user",content:""},childid)}onMount(()=>{node.subscribe(l=>{l.children.length>old_child_count?($$invalidate(3,openchild=0),console.log("child added",old_child_count),old_child_count=l.children.length):l.children.length<old_child_count&&(console.log("child removed"),$$invalidate(3,openchild=Math.max(0,openchild-1)),old_child_count=l.children.length)})});const click_handler=()=>{$$invalidate(3,openchild=Math.max(0,openchild-1))},click_handler_1=()=>{$$invalidate(3,openchild=Math.min($node.children.length-1,openchild+1))};return $$self.$$set=l=>{"nodeId"in l&&$$invalidate(0,nodeId=l.nodeId)},$$self.$$.update=()=>{$$self.$$.dirty&35&&nodeId!=oldid&&($$subscribe_node($$invalidate(2,node=getNode(nodeId))),$$invalidate(5,oldid=nodeId),old_child_count=$node.children.length,$$invalidate(3,openchild=0))},[nodeId,$node,node,openchild,send,oldid,click_handler,click_handler_1]}class ChatNode extends SvelteComponent{constructor(e){super(),init(this,e,instance$1,create_fragment$1,safe_not_equal,{nodeId:0})}}const _page_svelte_svelte_type_style_lang="";function create_fragment(l){let e,t,n="settings",a,s,i,o,_,d,c,m;return s=new ChatNode({props:{nodeId:0}}),{c(){e=element("main"),t=element("a"),t.textContent=n,a=space(),create_component(s.$$.fragment),i=space(),o=element("div"),_=element("button"),this.h()},l(r){e=claim_element(r,"MAIN",{class:!0});var u=children(e);t=claim_element(u,"A",{class:!0,href:!0,"data-svelte-h":!0}),get_svelte_dataset(t)!=="svelte-1jmuo4z"&&(t.textContent=n),a=claim_space(u),claim_component(s.$$.fragment,u),i=claim_space(u),o=claim_element(u,"DIV",{class:!0});var h=children(o);_=claim_element(h,"BUTTON",{class:!0}),children(_).forEach(detach),h.forEach(detach),u.forEach(detach),this.h()},h(){attr(t,"class","headerlink svelte-17h9ntx"),attr(t,"href","/settings"),attr(_,"class","homebtn svelte-17h9ntx"),attr(o,"class","footer svelte-17h9ntx"),attr(e,"class","svelte-17h9ntx")},m(r,u){insert_hydration(r,e,u),append_hydration(e,t),append_hydration(e,a),mount_component(s,e,null),append_hydration(e,i),append_hydration(e,o),append_hydration(o,_),d=!0,c||(m=listen(_,"click",l[0]),c=!0)},p:noop,i(r){d||(transition_in(s.$$.fragment,r),d=!0)},o(r){transition_out(s.$$.fragment,r),d=!1},d(r){r&&detach(e),destroy_component(s),c=!1,m()}}}function instance(l){function e(){createNode({role:"user",content:""},0)}return onMount(()=>{window.origin.includes("localhost")&&(document.title="LocalRing",console.log("local"))}),[e]}class Page extends SvelteComponent{constructor(e){super(),init(this,e,instance,create_fragment,safe_not_equal,{})}}export{Page as component};
