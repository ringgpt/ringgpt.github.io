import{f as get_store_value,s as safe_not_equal,n as noop,h as subscribe,o as onMount,b as binding_callbacks,r as run_all,i as null_to_empty}from"../chunks/scheduler.3578c530.js";import{S as SvelteComponent,i as init,g as element,s as space,h as claim_element,j as children,y as get_svelte_dataset,c as claim_space,f as detach,k as attr,a as insert_hydration,x as append_hydration,z as listen,m as text,n as claim_text,o as set_data,e as empty,H as HtmlTagHydration,A as claim_html_tag,l as set_style,d as transition_in,p as group_outros,t as transition_out,b as check_outros,r as create_component,u as claim_component,v as mount_component,w as destroy_component}from"../chunks/index.6edc28f2.js";import{w as writable}from"../chunks/paths.1d272cb0.js";function createWritable(l,e){var t;{if(typeof e=="string")t=localStorage[l]??e;else{let a=JSON.stringify(e),s=localStorage[l];s==="undefined"&&(localStorage[l]=a,s=a),t=JSON.parse(s??a)}e instanceof Date&&(t=new Date(t))}const n=writable(t);return n.subscribe(a=>{typeof a=="string"?localStorage[l]=a:localStorage[l]=JSON.stringify(a)}),n}const useserver=createWritable("useserver",!1),openaikey=createWritable("openaikey","");if(get_store_value(openaikey)==""){let l=prompt("please enter your openai key");l!=null&&openaikey.set(l)}const messagecount=createWritable("messagecount",0);let database={};localStorage.getItem("message_0")||(createNode({role:"assistant",content:"how can I help you?"},null),createNode({role:"user",content:"explain quantum computing for a five year old"},0),createNode({role:"user",content:'say "I love you" in binary'},0),createNode({role:"user",content:"show me a quine in javascript"},0),createNode({role:"user",content:"what is the current time?"},0));function getNode(l){return database[l]||(database[l]=createWritable(`message_${l}`,{message:{role:"assistant",content:"how can I help you?"},children:[],parent:null})),database[l]}function createNode(l,e){l.role=="function"&&l.content==null&&(l.content="");let t=0;messagecount.update(a=>(t=a,a+1));let n=getNode(t);return n==null||n.set({message:l,children:[],parent:e}),e!=null&&getNode(e).update(s=>({...s,children:[t,...s.children]})),t}function deleteNode(l){if(l==0)return;let e=get_store_value(getNode(l));if(e.parent==0&&get_store_value(getNode(0)).children.length==1&&createNode({role:"user",content:""},0),console.log("deleting ",l),e.parent!=null){let t=getNode(e.parent);t.update(n=>({...n,children:n.children.filter(a=>a!=l)})),console.log("parent ",get_store_value(t))}e.children.forEach(t=>{deleteNode(t)}),localStorage.removeItem(`message_${l}`),delete database[l]}const staticMessage_svelte_svelte_type_style_lang="";function create_else_block_1(l){let e,t,n,a="error243",s,o=l[1].content+"",c;return{c(){e=element("div"),t=element("div"),n=element("h2"),n.textContent=a,s=space(),c=text(o),this.h()},l(d){e=claim_element(d,"DIV",{});var r=children(e);t=claim_element(r,"DIV",{class:!0});var i=children(t);n=claim_element(i,"H2",{"data-svelte-h":!0}),get_svelte_dataset(n)!=="svelte-1donvxb"&&(n.textContent=a),s=claim_space(i),c=claim_text(i,o),i.forEach(detach),r.forEach(detach),this.h()},h(){attr(t,"class","msg svelte-1phlzee")},m(d,r){insert_hydration(d,e,r),append_hydration(e,t),append_hydration(t,n),append_hydration(t,s),append_hydration(t,c)},p(d,r){r&2&&o!==(o=d[1].content+"")&&set_data(c,o)},d(d){d&&detach(e)}}}function create_if_block_3(l){var s;let e,t,n=((s=l[5])==null?void 0:s.content)+"",a;return{c(){e=element("div"),t=element("div"),a=text(n),this.h()},l(o){e=claim_element(o,"DIV",{class:!0});var c=children(e);t=claim_element(c,"DIV",{class:!0});var d=children(t);a=claim_text(d,n),d.forEach(detach),c.forEach(detach),this.h()},h(){attr(t,"class","msg svelte-1phlzee"),attr(e,"class","function svelte-1phlzee")},m(o,c){insert_hydration(o,e,c),append_hydration(e,t),append_hydration(t,a)},p(o,c){var d;c&32&&n!==(n=((d=o[5])==null?void 0:d.content)+"")&&set_data(a,n)},d(o){o&&detach(e)}}}function create_if_block$2(l){let e;function t(s,o){return s[4]?create_if_block_1$1:create_else_block$2}let n=t(l),a=n(l);return{c(){a.c(),e=empty()},l(s){a.l(s),e=empty()},m(s,o){a.m(s,o),insert_hydration(s,e,o)},p(s,o){n===(n=t(s))&&a?a.p(s,o):(a.d(1),a=n(s),a&&(a.c(),a.m(e.parentNode,e)))},d(s){s&&detach(e),a.d(s)}}}function create_else_block$2(l){let e,t,n,a=tohtml$1(l[1].content)+"";return{c(){e=element("div"),t=element("div"),n=new HtmlTagHydration(!1),this.h()},l(s){e=claim_element(s,"DIV",{class:!0});var o=children(e);t=claim_element(o,"DIV",{class:!0});var c=children(t);n=claim_html_tag(c,!1),c.forEach(detach),o.forEach(detach),this.h()},h(){n.a=null,attr(t,"class","msg svelte-1phlzee"),attr(e,"class","assistant svelte-1phlzee")},m(s,o){insert_hydration(s,e,o),append_hydration(e,t),n.m(a,t)},p(s,o){o&2&&a!==(a=tohtml$1(s[1].content)+"")&&n.p(a)},d(s){s&&detach(e)}}}function create_if_block_1$1(l){let e,t,n,a=l[6]?"v":">",s,o,c=l[4].function_call.name+"",d,r,i,u,_=l[6]&&create_if_block_2$1(l);return{c(){e=element("div"),t=element("div"),n=element("button"),s=text(a),o=space(),d=text(c),r=space(),_&&_.c(),this.h()},l(h){e=claim_element(h,"DIV",{class:!0});var f=children(e);t=claim_element(f,"DIV",{class:!0});var m=children(t);n=claim_element(m,"BUTTON",{class:!0});var g=children(n);s=claim_text(g,a),o=claim_space(g),d=claim_text(g,c),g.forEach(detach),r=claim_space(m),_&&_.l(m),m.forEach(detach),f.forEach(detach),this.h()},h(){attr(n,"class","function_title svelte-1phlzee"),attr(t,"class","msg svelte-1phlzee"),attr(e,"class","assistant svelte-1phlzee")},m(h,f){insert_hydration(h,e,f),append_hydration(e,t),append_hydration(t,n),append_hydration(n,s),append_hydration(n,o),append_hydration(n,d),append_hydration(t,r),_&&_.m(t,null),i||(u=listen(n,"click",l[7]),i=!0)},p(h,f){f&64&&a!==(a=h[6]?"v":">")&&set_data(s,a),f&16&&c!==(c=h[4].function_call.name+"")&&set_data(d,c),h[6]?_?_.p(h,f):(_=create_if_block_2$1(h),_.c(),_.m(t,null)):_&&(_.d(1),_=null)},d(h){h&&detach(e),_&&_.d(),i=!1,u()}}}function create_if_block_2$1(l){let e,t=format_function_arguments(l[4].function_call.arguments)+"",n;return{c(){e=element("div"),n=text(t),this.h()},l(a){e=claim_element(a,"DIV",{style:!0});var s=children(e);n=claim_text(s,t),s.forEach(detach),this.h()},h(){set_style(e,"margin","1em")},m(a,s){insert_hydration(a,e,s),append_hydration(e,n)},p(a,s){s&16&&t!==(t=format_function_arguments(a[4].function_call.arguments)+"")&&set_data(n,t)},d(a){a&&detach(e)}}}function create_fragment$3(l){let e,t,n=" ",a,s,o,c="x",d,r;function i(h,f){return h[2].message.role=="assistant"?create_if_block$2:h[1].role=="function"?create_if_block_3:create_else_block_1}let u=i(l),_=u(l);return{c(){e=element("div"),t=element("button"),t.textContent=n,a=space(),_.c(),s=space(),o=element("button"),o.textContent=c,this.h()},l(h){e=claim_element(h,"DIV",{class:!0});var f=children(e);t=claim_element(f,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(t)!=="svelte-2nj3z4"&&(t.textContent=n),a=claim_space(f),_.l(f),s=claim_space(f),o=claim_element(f,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(o)!=="svelte-1fkcjn"&&(o.textContent=c),f.forEach(detach),this.h()},h(){attr(t,"class","svelte-1phlzee"),attr(o,"class","active svelte-1phlzee"),attr(e,"class","bubble svelte-1phlzee")},m(h,f){insert_hydration(h,e,f),append_hydration(e,t),append_hydration(e,a),_.m(e,null),append_hydration(e,s),append_hydration(e,o),d||(r=listen(o,"click",l[8]),d=!0)},p(h,[f]){u===(u=i(h))&&_?_.p(h,f):(_.d(1),_=u(h),_&&(_.c(),_.m(e,s)))},i:noop,o:noop,d(h){h&&detach(e),_.d(),d=!1,r()}}}function tohtml$1(l){if(l==null)return"";let e=l.replaceAll("<","&lt;").replace(/\n/g,"<br>");for(var t=0;;){let n=e.indexOf("```",t);if(n==-1)break;let a=e.indexOf("<br>",n+1),s=e.substring(n+3,a);if(t=e.indexOf("```",a),t==-1)break;let o=e.substring(a+4,t);o.replaceAll('"','\\"').replaceAll("<br>",`
`);let c=`<pre class="codeblock"><div> ${s} </div>`+o+"</pre>";e=e.substring(0,n)+c+e.substring(t+3)}return e}function format_function_arguments(l){try{let e=JSON.parse(l);return e.argument?e.argument:l}catch{return l}}function instance$3(l,e,t){let n,a=noop,s=()=>(a(),a=subscribe(c,f=>t(2,n=f)),c);l.$$.on_destroy.push(()=>a());let{id:o}=e,c=getNode(o);if(s(),n.message.role=="user")throw new Error("userMessage can only be used for user messages");let d=n.message,r=null,i=null;d.function_call&&(r=d),d.name&&(i=d);let u=!1;const _=()=>{t(6,u=!u)},h=()=>{deleteNode(o)};return l.$$set=f=>{"id"in f&&t(0,o=f.id)},l.$$.update=()=>{l.$$.dirty&7&&(s(t(3,c=getNode(o))),t(1,d=n.message),d.function_call?t(4,r=d):t(4,r=null),d.name?t(5,i=d):t(5,i=null))},[o,d,n,c,r,i,u,_,h]}class StaticMessage extends SvelteComponent{constructor(e){super(),init(this,e,instance$3,create_fragment$3,safe_not_equal,{id:0})}}async function chat_stream_request(l,e){return(await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},body:JSON.stringify({model:"gpt-3.5-turbo",messages:l.messages,temperature:l.temperature??.7,functions:[{name:"eval",description:"if you need to evaluate javascript code you can use this function",parameters:{type:"object",properties:{argument:{type:"string",description:"javascript code to evaluate"}},required:["argument"]}}],function_call:"auto",stream:!0})})).body}async function chatCompletion(l,e){let t;if(get_store_value(useserver)){let s=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(s.body==null){console.error("failed to get response stream");return}if(s.body==null){console.error("failed to get response stream");return}t=s.body.getReader()}else t=(await chat_stream_request(l,get_store_value(openaikey))).getReader();let n=new TextDecoder,a=!1;for(;!a;){const{value:s,done:o}=await t.read();a=o,n.decode(s).split(`
`).filter(r=>r.length>0).forEach(r=>{if(r=="data: [DONE]")return;if(!r.startsWith("data:"))throw console.error("unexpected response",r),new Error("unexpected response");let i=JSON.parse(r.slice(6));if(i.choices[0].delta.content)e.update(u=>(u.content+=i.choices[0].delta.content,u));else if(i.choices[0].delta.function_call){let u=i.choices[0].delta.function_call;u.name?e.update(_=>(_.function_call=u,_)):e.update(_=>(_.function_call.arguments+=u.arguments,_))}})}}const dynamicMessage_svelte_svelte_type_style_lang="";function create_else_block$1(l){let e,t;return{c(){e=element("div"),t=element("div"),this.h()},l(n){e=claim_element(n,"DIV",{class:!0});var a=children(e);t=claim_element(a,"DIV",{class:!0}),children(t).forEach(detach),a.forEach(detach),this.h()},h(){attr(t,"class","msg svelte-z15wxn"),attr(e,"class","assistant svelte-z15wxn")},m(n,a){insert_hydration(n,e,a),append_hydration(e,t),l[13](t)},p:noop,d(n){n&&detach(e),l[13](null)}}}function create_if_block$1(l){let e,t,n,a,s="x",o,c;return{c(){e=element("div"),t=element("div"),n=space(),a=element("button"),a.textContent=s,this.h()},l(d){e=claim_element(d,"DIV",{class:!0});var r=children(e);t=claim_element(r,"DIV",{contenteditable:!0,class:!0}),children(t).forEach(detach),n=claim_space(r),a=claim_element(r,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(a)!=="svelte-1n9arnn"&&(a.textContent=s),r.forEach(detach),this.h()},h(){attr(t,"contenteditable",""),attr(t,"class","msg svelte-z15wxn"),attr(a,"class","active svelte-z15wxn"),attr(e,"class","user svelte-z15wxn")},m(d,r){insert_hydration(d,e,r),append_hydration(e,t),l[11](t),append_hydration(e,n),append_hydration(e,a),o||(c=[listen(t,"keypress",l[4]),listen(t,"keyup",l[6]),listen(t,"keydown",l[5]),listen(t,"input",l[7]),listen(t,"paste",onpaste),listen(a,"click",l[12])],o=!0)},p:noop,d(d){d&&detach(e),l[11](null),o=!1,run_all(c)}}}function create_fragment$2(l){let e,t,n=" ",a,s,o,c="x",d,r;function i(h,f){return h[2].message.role=="user"?create_if_block$1:create_else_block$1}let u=i(l),_=u(l);return{c(){e=element("div"),t=element("button"),t.textContent=n,a=space(),_.c(),s=space(),o=element("button"),o.textContent=c,this.h()},l(h){e=claim_element(h,"DIV",{class:!0});var f=children(e);t=claim_element(f,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(t)!=="svelte-2nj3z4"&&(t.textContent=n),a=claim_space(f),_.l(f),s=claim_space(f),o=claim_element(f,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(o)!=="svelte-1fkcjn"&&(o.textContent=c),f.forEach(detach),this.h()},h(){attr(t,"class","svelte-z15wxn"),attr(o,"class","active svelte-z15wxn"),attr(e,"class","bubble svelte-z15wxn")},m(h,f){insert_hydration(h,e,f),append_hydration(e,t),append_hydration(e,a),_.m(e,null),append_hydration(e,s),append_hydration(e,o),d||(r=listen(o,"click",l[14]),d=!0)},p(h,[f]){u===(u=i(h))&&_?_.p(h,f):(_.d(1),_=u(h),_&&(_.c(),_.m(e,s)))},i:noop,o:noop,d(h){h&&detach(e),_.d(),d=!1,r()}}}function tohtml(l){let e=l.replaceAll("<","&lt;").replace(/\n/g,"<br>");for(var t=0;;){let n=e.indexOf("```",t);if(n==-1)break;let a=e.indexOf("<br>",n+1),s=e.substring(n+3,a);if(t=e.indexOf("```",a),t==-1)break;let o=e.substring(a+4,t),c=o.replaceAll('"','\\"').replaceAll("<br>",`
`),d=`<pre class="codeblock"><div> ${s} <button onclick='navigator.clipboard.writeText(\`${c}\`)'>copy</button> </div>`+o+"</pre>";e=e.substring(0,n)+d+e.substring(t+3)}return e}function totext(l){return l.replace(/<br>/g,`
`)}function cleanMarkup(l){let e=document.createElement("textarea");return e.innerHTML=l,e.remove(),e.value}function onpaste(l){var t;l.preventDefault(),console.log("paste");let e=(t=l.clipboardData)==null?void 0:t.getData("text/plain");e&&document.execCommand("insertText",!1,e)}function instance$2(l,e,t){let n,a=noop,s=()=>(a(),a=subscribe(r,p=>t(2,n=p)),r);l.$$.on_destroy.push(()=>a());let{id:o}=e,c=o,{sendMessage:d}=e,r=getNode(o);s();let i;onMount(()=>{t(1,i.innerHTML=tohtml(n.message.content),i)});let u=!1;function _(p){p.key=="Enter"&&!u&&(p.preventDefault(),d())}function h(p){p.key=="Shift"&&(u=!0)}function f(p){p.key=="Shift"&&(u=!1)}function m(p){let k=totext(i.innerHTML),N=n.message.content;n.children.length>0?(createNode({role:"user",content:k},n.parent),t(1,i.innerHTML=tohtml(N),i),console.log("create new node",k)):r.update($=>($.message.content=k,$))}function g(p){binding_callbacks[p?"unshift":"push"](()=>{i=p,t(1,i),t(0,o),t(10,c),t(2,n)})}const v=()=>{deleteNode(o)};function b(p){binding_callbacks[p?"unshift":"push"](()=>{i=p,t(1,i),t(0,o),t(10,c),t(2,n)})}const y=()=>{deleteNode(o)};return l.$$set=p=>{"id"in p&&t(0,o=p.id),"sendMessage"in p&&t(8,d=p.sendMessage)},l.$$.update=()=>{l.$$.dirty&1031&&(s(t(3,r=getNode(o))),i&&c!=o&&(t(1,i.innerHTML=tohtml(n.message.content),i),t(10,c=o),i.focus()))},[o,i,n,r,_,h,f,m,d,cleanMarkup,c,g,v,b,y]}class DynamicMessage extends SvelteComponent{constructor(e){super(),init(this,e,instance$2,create_fragment$2,safe_not_equal,{id:0,sendMessage:8,cleanMarkup:9})}get cleanMarkup(){return cleanMarkup}}const chatNode_svelte_svelte_type_style_lang="";function create_if_block(l){let e,t,n,a,s;const o=[create_if_block_2,create_else_block],c=[];function d(i,u){return i[1].message.role=="user"?0:1}e=d(l),t=c[e]=o[e](l);let r=l[1].children.length>0&&create_if_block_1(l);return{c(){t.c(),n=space(),r&&r.c(),a=empty()},l(i){t.l(i),n=claim_space(i),r&&r.l(i),a=empty()},m(i,u){c[e].m(i,u),insert_hydration(i,n,u),r&&r.m(i,u),insert_hydration(i,a,u),s=!0},p(i,u){let _=e;e=d(i),e===_?c[e].p(i,u):(group_outros(),transition_out(c[_],1,1,()=>{c[_]=null}),check_outros(),t=c[e],t?t.p(i,u):(t=c[e]=o[e](i),t.c()),transition_in(t,1),t.m(n.parentNode,n)),i[1].children.length>0?r?(r.p(i,u),u&2&&transition_in(r,1)):(r=create_if_block_1(i),r.c(),transition_in(r,1),r.m(a.parentNode,a)):r&&(group_outros(),transition_out(r,1,1,()=>{r=null}),check_outros())},i(i){s||(transition_in(t),transition_in(r),s=!0)},o(i){transition_out(t),transition_out(r),s=!1},d(i){i&&(detach(n),detach(a)),c[e].d(i),r&&r.d(i)}}}function create_else_block(l){let e,t;return e=new StaticMessage({props:{id:l[0]}}),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,a){mount_component(e,n,a),t=!0},p(n,a){const s={};a&1&&(s.id=n[0]),e.$set(s)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}function create_if_block_2(l){let e,t;return e=new DynamicMessage({props:{id:l[0],sendMessage:l[4]}}),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,a){mount_component(e,n,a),t=!0},p(n,a){const s={};a&1&&(s.id=n[0]),e.$set(s)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}function create_if_block_1(l){let e,t,n,a,s,o,c,d,r,i,u,_,h,f;return u=new ChatNode({props:{nodeId:l[1].children[l[3]]}}),{c(){e=element("div"),t=element("button"),n=text("<"),s=space(),o=element("button"),c=text(">"),r=space(),i=element("div"),create_component(u.$$.fragment),this.h()},l(m){e=claim_element(m,"DIV",{class:!0});var g=children(e);t=claim_element(g,"BUTTON",{class:!0});var v=children(t);n=claim_text(v,"<"),v.forEach(detach),s=claim_space(g),o=claim_element(g,"BUTTON",{class:!0});var b=children(o);c=claim_text(b,">"),b.forEach(detach),g.forEach(detach),r=claim_space(m),i=claim_element(m,"DIV",{});var y=children(i);claim_component(u.$$.fragment,y),y.forEach(detach),this.h()},h(){attr(t,"class",a=null_to_empty(l[3]>0?"active":"hidden")+" svelte-1usy634"),attr(o,"class",d=null_to_empty(l[1].children.length>l[3]+1?"active":"hidden")+" svelte-1usy634"),attr(e,"class","navbar svelte-1usy634")},m(m,g){insert_hydration(m,e,g),append_hydration(e,t),append_hydration(t,n),append_hydration(e,s),append_hydration(e,o),append_hydration(o,c),insert_hydration(m,r,g),insert_hydration(m,i,g),mount_component(u,i,null),_=!0,h||(f=[listen(t,"click",l[6]),listen(o,"click",l[7])],h=!0)},p(m,g){(!_||g&8&&a!==(a=null_to_empty(m[3]>0?"active":"hidden")+" svelte-1usy634"))&&attr(t,"class",a),(!_||g&10&&d!==(d=null_to_empty(m[1].children.length>m[3]+1?"active":"hidden")+" svelte-1usy634"))&&attr(o,"class",d);const v={};g&10&&(v.nodeId=m[1].children[m[3]]),u.$set(v)},i(m){_||(transition_in(u.$$.fragment,m),_=!0)},o(m){transition_out(u.$$.fragment,m),_=!1},d(m){m&&(detach(e),detach(r),detach(i)),destroy_component(u),h=!1,run_all(f)}}}function create_fragment$1(l){let e,t,n=l[1]&&create_if_block(l);return{c(){n&&n.c(),e=empty()},l(a){n&&n.l(a),e=empty()},m(a,s){n&&n.m(a,s),insert_hydration(a,e,s),t=!0},p(a,[s]){a[1]?n?(n.p(a,s),s&2&&transition_in(n,1)):(n=create_if_block(a),n.c(),transition_in(n,1),n.m(e.parentNode,e)):n&&(group_outros(),transition_out(n,1,1,()=>{n=null}),check_outros())},i(a){t||(transition_in(n),t=!0)},o(a){transition_out(n),t=!1},d(a){a&&detach(e),n&&n.d(a)}}}function instance$1($$self,$$props,$$invalidate){let $node,$$unsubscribe_node=noop,$$subscribe_node=()=>($$unsubscribe_node(),$$unsubscribe_node=subscribe(node,l=>$$invalidate(1,$node=l)),node);$$self.$$.on_destroy.push(()=>$$unsubscribe_node());let{nodeId}=$$props,node=getNode(nodeId);$$subscribe_node();let old_child_count=$node?$node.children.length:0;var oldid=nodeId;let openchild=0;function get_history(){let l=[$node.message],e=$node.parent;for(;e!=null;){let t=getNode(e);l=[get_store_value(t).message,...l],e=get_store_value(t).parent}return console.log(l),l}async function send(){let hist=get_history(),childid=createNode({role:"assistant",content:""},nodeId),child=getNode(childid),message=writable(get_store_value(child).message);if(message.subscribe(l=>{child.update(e=>({...e,message:l}))}),await chatCompletion({messages:hist},message),get_store_value(message).function_call){let fcall=get_store_value(message).function_call;if((fcall==null?void 0:fcall.name)=="eval"){let res,res_string="";childid=createNode({role:"function",name:"eval",content:res_string},childid);let function_node=getNode(childid);try{let conslog=function(...l){res_string+=l+`
`,console.log(res_string),console.log(child),function_node.update(e=>({...e,message:{...e.message,content:res_string}}))},call=JSON.parse(fcall.arguments),code=call.argument.replaceAll("console.log","conslog");res=eval(code),res instanceof Promise&&(console.log("awaiting promise"),res=await res,res_string+=JSON.stringify(res)),console.log(res),res_string+=JSON.stringify(res)??"",function_node.update(l=>({...l,message:{...l.message,content:res_string}}))}catch(l){console.log(l),console.log(fcall.arguments);let e=String(l);console.log(e),res_string+=e,function_node.update(t=>({...t,message:{...t.message,content:res_string}}))}}}createNode({role:"user",content:""},childid)}onMount(()=>{node.subscribe(l=>{l.children.length>old_child_count?($$invalidate(3,openchild=0),console.log("child added",old_child_count),old_child_count=l.children.length):l.children.length<old_child_count&&(console.log("child removed"),$$invalidate(3,openchild=Math.max(0,openchild-1)),old_child_count=l.children.length)})});const click_handler=()=>{$$invalidate(3,openchild=Math.max(0,openchild-1))},click_handler_1=()=>{$$invalidate(3,openchild=Math.min($node.children.length-1,openchild+1))};return $$self.$$set=l=>{"nodeId"in l&&$$invalidate(0,nodeId=l.nodeId)},$$self.$$.update=()=>{$$self.$$.dirty&35&&nodeId!=oldid&&($$subscribe_node($$invalidate(2,node=getNode(nodeId))),$$invalidate(5,oldid=nodeId),old_child_count=$node.children.length,$$invalidate(3,openchild=0))},[nodeId,$node,node,openchild,send,oldid,click_handler,click_handler_1]}class ChatNode extends SvelteComponent{constructor(e){super(),init(this,e,instance$1,create_fragment$1,safe_not_equal,{nodeId:0})}}const _page_svelte_svelte_type_style_lang="";function create_fragment(l){let e,t,n,a,s,o,c,d;return t=new ChatNode({props:{nodeId:0}}),{c(){e=element("main"),create_component(t.$$.fragment),n=space(),a=element("div"),s=element("button"),this.h()},l(r){e=claim_element(r,"MAIN",{class:!0});var i=children(e);claim_component(t.$$.fragment,i),n=claim_space(i),a=claim_element(i,"DIV",{class:!0});var u=children(a);s=claim_element(u,"BUTTON",{class:!0}),children(s).forEach(detach),u.forEach(detach),i.forEach(detach),this.h()},h(){attr(s,"class","homebtn svelte-1s0k47m"),attr(a,"class","footer svelte-1s0k47m"),attr(e,"class","svelte-1s0k47m")},m(r,i){insert_hydration(r,e,i),mount_component(t,e,null),append_hydration(e,n),append_hydration(e,a),append_hydration(a,s),o=!0,c||(d=listen(s,"click",l[0]),c=!0)},p:noop,i(r){o||(transition_in(t.$$.fragment,r),o=!0)},o(r){transition_out(t.$$.fragment,r),o=!1},d(r){r&&detach(e),destroy_component(t),c=!1,d()}}}function instance(l){function e(){createNode({role:"user",content:""},0)}return onMount(()=>{window.origin.includes("localhost")&&(document.title="LocalRing",console.log("local"))}),[e]}class Page extends SvelteComponent{constructor(e){super(),init(this,e,instance,create_fragment,safe_not_equal,{})}}export{Page as component};
