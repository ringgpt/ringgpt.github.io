import{s as safe_not_equal,n as noop,f as subscribe,h as get_store_value,o as onMount,b as binding_callbacks,r as run_all,e as component_subscribe,i as null_to_empty}from"../chunks/scheduler.debfefe8.js";import{S as SvelteComponent,i as init,g as element,s as space,h as claim_element,j as children,y as get_svelte_dataset,c as claim_space,f as detach,k as attr,a as insert_hydration,x as append_hydration,z as listen,m as text,n as claim_text,o as set_data,H as HtmlTagHydration,A as claim_html_tag,e as empty,l as set_style,d as transition_in,p as group_outros,t as transition_out,b as check_outros,r as create_component,u as claim_component,v as mount_component,w as destroy_component}from"../chunks/index.54b8959a.js";import{g as getNode,d as deleteNode,u as useserver,o as openaikey,c as createNode,a as context_message_number,b as active_persona,p as personas}from"../chunks/store.182a4e3d.js";import{w as writable}from"../chunks/index.7cc10669.js";const staticMessage_svelte_svelte_type_style_lang="";function create_else_block$1(l){let e,t,n,i="error not expected type",a,s=l[1].content+"",c;return{c(){e=element("div"),t=element("div"),n=element("h2"),n.textContent=i,a=space(),c=text(s),this.h()},l(u){e=claim_element(u,"DIV",{});var o=children(e);t=claim_element(o,"DIV",{class:!0});var r=children(t);n=claim_element(r,"H2",{"data-svelte-h":!0}),get_svelte_dataset(n)!=="svelte-wun3cb"&&(n.textContent=i),a=claim_space(r),c=claim_text(r,s),r.forEach(detach),o.forEach(detach),this.h()},h(){attr(t,"class","msg svelte-124jswh")},m(u,o){insert_hydration(u,e,o),append_hydration(e,t),append_hydration(t,n),append_hydration(t,a),append_hydration(t,c)},p(u,o){o&2&&s!==(s=u[1].content+"")&&set_data(c,s)},d(u){u&&detach(e)}}}function create_if_block$3(l){let e,t,n,i=tohtml$1(l[1].content)+"",a,s=l[4]&&create_if_block_1$1(l);return{c(){e=element("div"),t=element("div"),n=new HtmlTagHydration(!1),a=space(),s&&s.c(),this.h()},l(c){e=claim_element(c,"DIV",{class:!0});var u=children(e);t=claim_element(u,"DIV",{class:!0});var o=children(t);n=claim_html_tag(o,!1),a=claim_space(o),s&&s.l(o),o.forEach(detach),u.forEach(detach),this.h()},h(){n.a=a,attr(t,"class","msg svelte-124jswh"),attr(e,"class","assistant svelte-124jswh")},m(c,u){insert_hydration(c,e,u),append_hydration(e,t),n.m(i,t),append_hydration(t,a),s&&s.m(t,null)},p(c,u){u&2&&i!==(i=tohtml$1(c[1].content)+"")&&n.p(i),c[4]?s?s.p(c,u):(s=create_if_block_1$1(c),s.c(),s.m(t,null)):s&&(s.d(1),s=null)},d(c){c&&detach(e),s&&s.d()}}}function create_if_block_1$1(l){let e,t,n=l[5]?"v":">",i,a,s=l[4].function_call.name+"",c,u,o,r,_,d=l[1].content&&create_if_block_3$1(),f=l[5]&&create_if_block_2$1(l);return{c(){d&&d.c(),e=space(),t=element("button"),i=text(n),a=space(),c=text(s),u=space(),f&&f.c(),o=empty(),this.h()},l(m){d&&d.l(m),e=claim_space(m),t=claim_element(m,"BUTTON",{class:!0});var p=children(t);i=claim_text(p,n),a=claim_space(p),c=claim_text(p,s),p.forEach(detach),u=claim_space(m),f&&f.l(m),o=empty(),this.h()},h(){attr(t,"class","function_title svelte-124jswh")},m(m,p){d&&d.m(m,p),insert_hydration(m,e,p),insert_hydration(m,t,p),append_hydration(t,i),append_hydration(t,a),append_hydration(t,c),insert_hydration(m,u,p),f&&f.m(m,p),insert_hydration(m,o,p),r||(_=listen(t,"click",l[6]),r=!0)},p(m,p){m[1].content?d||(d=create_if_block_3$1(),d.c(),d.m(e.parentNode,e)):d&&(d.d(1),d=null),p&32&&n!==(n=m[5]?"v":">")&&set_data(i,n),p&16&&s!==(s=m[4].function_call.name+"")&&set_data(c,s),m[5]?f?f.p(m,p):(f=create_if_block_2$1(m),f.c(),f.m(o.parentNode,o)):f&&(f.d(1),f=null)},d(m){m&&(detach(e),detach(t),detach(u),detach(o)),d&&d.d(m),f&&f.d(m),r=!1,_()}}}function create_if_block_3$1(l){let e;return{c(){e=element("br")},l(t){e=claim_element(t,"BR",{})},m(t,n){insert_hydration(t,e,n)},d(t){t&&detach(e)}}}function create_if_block_2$1(l){let e,t=format_function_arguments(l[4].function_call.arguments)+"",n,i,a,s,c=get_store_value(getNode(l[2].children[0])).message.content+"",u;return{c(){e=element("div"),n=text(t),i=space(),a=element("div"),s=text("> "),u=text(c),this.h()},l(o){e=claim_element(o,"DIV",{style:!0});var r=children(e);n=claim_text(r,t),r.forEach(detach),i=claim_space(o),a=claim_element(o,"DIV",{});var _=children(a);s=claim_text(_,"> "),u=claim_text(_,c),_.forEach(detach),this.h()},h(){set_style(e,"margin-top","1em")},m(o,r){insert_hydration(o,e,r),append_hydration(e,n),insert_hydration(o,i,r),insert_hydration(o,a,r),append_hydration(a,s),append_hydration(a,u)},p(o,r){r&16&&t!==(t=format_function_arguments(o[4].function_call.arguments)+"")&&set_data(n,t),r&4&&c!==(c=get_store_value(getNode(o[2].children[0])).message.content+"")&&set_data(u,c)},d(o){o&&(detach(e),detach(i),detach(a))}}}function create_fragment$3(l){let e,t,n=" ",i,a,s,c="x",u,o;function r(f,m){return f[2].message.role=="assistant"?create_if_block$3:create_else_block$1}let _=r(l),d=_(l);return{c(){e=element("div"),t=element("button"),t.textContent=n,i=space(),d.c(),a=space(),s=element("button"),s.textContent=c,this.h()},l(f){e=claim_element(f,"DIV",{class:!0});var m=children(e);t=claim_element(m,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(t)!=="svelte-2nj3z4"&&(t.textContent=n),i=claim_space(m),d.l(m),a=claim_space(m),s=claim_element(m,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(s)!=="svelte-1fkcjn"&&(s.textContent=c),m.forEach(detach),this.h()},h(){attr(t,"class","svelte-124jswh"),attr(s,"class","active svelte-124jswh"),attr(e,"class","bubble svelte-124jswh")},m(f,m){insert_hydration(f,e,m),append_hydration(e,t),append_hydration(e,i),d.m(e,null),append_hydration(e,a),append_hydration(e,s),u||(o=listen(s,"click",l[7]),u=!0)},p(f,[m]){_===(_=r(f))&&d?d.p(f,m):(d.d(1),d=_(f),d&&(d.c(),d.m(e,a)))},i:noop,o:noop,d(f){f&&detach(e),d.d(),u=!1,o()}}}function tohtml$1(l){if(l==null)return"";let e=l.replaceAll("<","&lt;").replace(/\n/g,"<br>");for(var t=0;;){let n=e.indexOf("```",t);if(n==-1)break;let i=e.indexOf("<br>",n+1),a=e.substring(n+3,i);if(t=e.indexOf("```",i),t==-1)break;let s=e.substring(i+4,t);s.replaceAll('"','\\"').replaceAll("<br>",`
`);let c=`<pre class="codeblock"><div> ${a} </div>`+s+"</pre>";e=e.substring(0,n)+c+e.substring(t+3)}return e}function format_function_arguments(l){try{let e=JSON.parse(l);return e.argument?e.argument:l}catch{return l}}function instance$3(l,e,t){let n,i=noop,a=()=>(i(),i=subscribe(c,f=>t(2,n=f)),c);l.$$.on_destroy.push(()=>i());let{id:s}=e,c=getNode(s);if(a(),n.message.role=="user")throw new Error("userMessage can only be used for user messages");let u=n.message,o=null;u.function_call&&(o=u);let r=!1;const _=()=>{t(5,r=!r)},d=()=>{deleteNode(s)};return l.$$set=f=>{"id"in f&&t(0,s=f.id)},l.$$.update=()=>{l.$$.dirty&7&&(a(t(3,c=getNode(s))),t(1,u=n.message),u.function_call?t(4,o=u):t(4,o=null))},[s,u,n,c,o,r,_,d]}class StaticMessage extends SvelteComponent{constructor(e){super(),init(this,e,instance$3,create_fragment$3,safe_not_equal,{id:0})}}async function chat_stream_request(l,e){return(await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},body:JSON.stringify({model:"gpt-3.5-turbo",messages:l.messages,temperature:l.temperature??.7,functions:[{name:"eval",description:"Use this function to evaluate any javascript code. It can fetch information from the internet.",parameters:{type:"object",properties:{argument:{type:"string",description:"javascript code to evaluate"}},required:["argument"]}},{name:"fetch_grocery_sortiment",description:"Use this function to fetch the grocery sortiment from the internet.",parameters:{type:"object",properties:{store:{type:"string",description:"The store to fetch the sortiment from."},name:{type:"string",description:"The name of the product to fetch."}}}}],function_call:"auto",stream:!0})})).body}async function chatCompletion(l,e){let t;if(get_store_value(useserver)){let a=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(a.body==null){console.error("failed to get response stream");return}if(a.body==null){console.error("failed to get response stream");return}t=a.body.getReader()}else t=(await chat_stream_request(l,get_store_value(openaikey))).getReader();let n=new TextDecoder,i=!1;for(;!i;){const{value:a,done:s}=await t.read();i=s,n.decode(a).split(`
`).filter(o=>o.length>0).forEach(o=>{if(o=="data: [DONE]")return;if(!o.startsWith("data:"))throw console.error("unexpected response",o),new Error("unexpected response");let r=JSON.parse(o.slice(6));if(r.choices[0].delta.content)e.update(_=>(_.content+=r.choices[0].delta.content,_));else if(r.choices[0].delta.function_call){let _=r.choices[0].delta.function_call;_.name?e.update(d=>(d.function_call=_,d)):e.update(d=>(d.function_call.arguments+=_.arguments,d))}})}}const dynamicMessage_svelte_svelte_type_style_lang="";function create_else_block(l){let e,t;return{c(){e=element("div"),t=element("div"),this.h()},l(n){e=claim_element(n,"DIV",{class:!0});var i=children(e);t=claim_element(i,"DIV",{class:!0}),children(t).forEach(detach),i.forEach(detach),this.h()},h(){attr(t,"class","msg svelte-y5c4bh"),attr(e,"class","assistant svelte-y5c4bh")},m(n,i){insert_hydration(n,e,i),append_hydration(e,t),l[12](t)},p:noop,d(n){n&&detach(e),l[12](null)}}}function create_if_block$2(l){let e,t,n,i;return{c(){e=element("div"),t=element("div"),this.h()},l(a){e=claim_element(a,"DIV",{class:!0});var s=children(e);t=claim_element(s,"DIV",{contenteditable:!0,class:!0}),children(t).forEach(detach),s.forEach(detach),this.h()},h(){attr(t,"contenteditable",""),attr(t,"class","msg svelte-y5c4bh"),attr(e,"class","user svelte-y5c4bh")},m(a,s){insert_hydration(a,e,s),append_hydration(e,t),l[11](t),n||(i=[listen(t,"keypress",l[4]),listen(t,"keyup",l[6]),listen(t,"keydown",l[5]),listen(t,"input",l[7]),listen(t,"paste",onpaste)],n=!0)},p:noop,d(a){a&&detach(e),l[11](null),n=!1,run_all(i)}}}function create_fragment$2(l){let e,t,n=" ",i,a,s,c="x",u,o;function r(f,m){return f[2].message.role=="user"?create_if_block$2:create_else_block}let _=r(l),d=_(l);return{c(){e=element("div"),t=element("button"),t.textContent=n,i=space(),d.c(),a=space(),s=element("button"),s.textContent=c,this.h()},l(f){e=claim_element(f,"DIV",{class:!0});var m=children(e);t=claim_element(m,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(t)!=="svelte-2nj3z4"&&(t.textContent=n),i=claim_space(m),d.l(m),a=claim_space(m),s=claim_element(m,"BUTTON",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(s)!=="svelte-1fkcjn"&&(s.textContent=c),m.forEach(detach),this.h()},h(){attr(t,"class","svelte-y5c4bh"),attr(s,"class","active svelte-y5c4bh"),attr(e,"class","bubble svelte-y5c4bh")},m(f,m){insert_hydration(f,e,m),append_hydration(e,t),append_hydration(e,i),d.m(e,null),append_hydration(e,a),append_hydration(e,s),u||(o=listen(s,"click",l[13]),u=!0)},p(f,[m]){_===(_=r(f))&&d?d.p(f,m):(d.d(1),d=_(f),d&&(d.c(),d.m(e,a)))},i:noop,o:noop,d(f){f&&detach(e),d.d(),u=!1,o()}}}function tohtml(l){let e=l.replaceAll("<","&lt;").replace(/\n/g,"<br>");for(var t=0;;){let n=e.indexOf("```",t);if(n==-1)break;let i=e.indexOf("<br>",n+1),a=e.substring(n+3,i);if(t=e.indexOf("```",i),t==-1)break;let s=e.substring(i+4,t),c=s.replaceAll('"','\\"').replaceAll("<br>",`
`),u=`<pre class="codeblock"><div> ${a} <button onclick='navigator.clipboard.writeText(\`${c}\`)'>copy</button> </div>`+s+"</pre>";e=e.substring(0,n)+u+e.substring(t+3)}return e}function totext(l){return l.replace(/<br>/g,`
`)}function cleanMarkup(l){let e=document.createElement("textarea");return e.innerHTML=l,e.remove(),e.value}function onpaste(l){var t;l.preventDefault(),console.log("paste");let e=(t=l.clipboardData)==null?void 0:t.getData("text/plain");e&&document.execCommand("insertText",!1,e)}function instance$2(l,e,t){let n,i=noop,a=()=>(i(),i=subscribe(o,h=>t(2,n=h)),o);l.$$.on_destroy.push(()=>i());let{id:s}=e,c=s,{sendMessage:u}=e,o=getNode(s);a();let r;onMount(()=>{t(1,r.innerHTML=tohtml(n.message.content),r)});let _=!1;function d(h){h.key=="Enter"&&!_&&(h.preventDefault(),u())}function f(h){h.key=="Shift"&&(_=!0)}function m(h){h.key=="Shift"&&(_=!1)}function p(h){let g=totext(r.innerHTML),$=n.message.content;n.children.length>0?(createNode({role:"user",content:g},n.parent),t(1,r.innerHTML=tohtml($),r),console.log("create new node",g)):o.update(b=>(b.message.content=g,b))}function v(h){binding_callbacks[h?"unshift":"push"](()=>{r=h,t(1,r),t(0,s),t(10,c),t(2,n)})}function y(h){binding_callbacks[h?"unshift":"push"](()=>{r=h,t(1,r),t(0,s),t(10,c),t(2,n)})}const k=()=>{deleteNode(s)};return l.$$set=h=>{"id"in h&&t(0,s=h.id),"sendMessage"in h&&t(8,u=h.sendMessage)},l.$$.update=()=>{l.$$.dirty&1031&&(a(t(3,o=getNode(s))),r&&c!=s&&(t(1,r.innerHTML=tohtml(n.message.content),r),t(10,c=s)))},[s,r,n,o,d,f,m,p,u,cleanMarkup,c,v,y,k]}class DynamicMessage extends SvelteComponent{constructor(e){super(),init(this,e,instance$2,create_fragment$2,safe_not_equal,{id:0,sendMessage:8,cleanMarkup:9})}get cleanMarkup(){return cleanMarkup}}const chatNode_svelte_svelte_type_style_lang="";function create_if_block$1(l){let e,t,n,i,a;const s=[create_if_block_3,create_if_block_4],c=[];function u(r,_){return r[1].message.role=="user"?0:r[1].message.role!="system"&&r[1].message.role!="function"?1:-1}~(e=u(l))&&(t=c[e]=s[e](l));let o=l[1].children.length>0&&create_if_block_1(l);return{c(){t&&t.c(),n=space(),o&&o.c(),i=empty()},l(r){t&&t.l(r),n=claim_space(r),o&&o.l(r),i=empty()},m(r,_){~e&&c[e].m(r,_),insert_hydration(r,n,_),o&&o.m(r,_),insert_hydration(r,i,_),a=!0},p(r,_){let d=e;e=u(r),e===d?~e&&c[e].p(r,_):(t&&(group_outros(),transition_out(c[d],1,1,()=>{c[d]=null}),check_outros()),~e?(t=c[e],t?t.p(r,_):(t=c[e]=s[e](r),t.c()),transition_in(t,1),t.m(n.parentNode,n)):t=null),r[1].children.length>0?o?(o.p(r,_),_&2&&transition_in(o,1)):(o=create_if_block_1(r),o.c(),transition_in(o,1),o.m(i.parentNode,i)):o&&(group_outros(),transition_out(o,1,1,()=>{o=null}),check_outros())},i(r){a||(transition_in(t),transition_in(o),a=!0)},o(r){transition_out(t),transition_out(o),a=!1},d(r){r&&(detach(n),detach(i)),~e&&c[e].d(r),o&&o.d(r)}}}function create_if_block_4(l){let e,t;return e=new StaticMessage({props:{id:l[0]}}),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,i){mount_component(e,n,i),t=!0},p(n,i){const a={};i&1&&(a.id=n[0]),e.$set(a)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}function create_if_block_3(l){let e,t;return e=new DynamicMessage({props:{id:l[0],sendMessage:l[4]}}),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,i){mount_component(e,n,i),t=!0},p(n,i){const a={};i&1&&(a.id=n[0]),e.$set(a)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}function create_if_block_1(l){let e,t,n,i,a=l[1].message.role!="system"&&l[1].message.role!="function"&&create_if_block_2(l);return n=new ChatNode({props:{nodeId:l[1].children[l[3]]}}),{c(){a&&a.c(),e=space(),t=element("div"),create_component(n.$$.fragment)},l(s){a&&a.l(s),e=claim_space(s),t=claim_element(s,"DIV",{});var c=children(t);claim_component(n.$$.fragment,c),c.forEach(detach)},m(s,c){a&&a.m(s,c),insert_hydration(s,e,c),insert_hydration(s,t,c),mount_component(n,t,null),i=!0},p(s,c){s[1].message.role!="system"&&s[1].message.role!="function"?a?a.p(s,c):(a=create_if_block_2(s),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null);const u={};c&10&&(u.nodeId=s[1].children[s[3]]),n.$set(u)},i(s){i||(transition_in(n.$$.fragment,s),i=!0)},o(s){transition_out(n.$$.fragment,s),i=!1},d(s){s&&(detach(e),detach(t)),a&&a.d(s),destroy_component(n)}}}function create_if_block_2(l){let e,t,n,i,a,s,c,u,o,r;return{c(){e=element("div"),t=element("button"),n=text("<"),a=space(),s=element("button"),c=text(">"),this.h()},l(_){e=claim_element(_,"DIV",{class:!0});var d=children(e);t=claim_element(d,"BUTTON",{class:!0});var f=children(t);n=claim_text(f,"<"),f.forEach(detach),a=claim_space(d),s=claim_element(d,"BUTTON",{class:!0});var m=children(s);c=claim_text(m,">"),m.forEach(detach),d.forEach(detach),this.h()},h(){attr(t,"class",i=null_to_empty(l[3]>0?"active":"hidden")+" svelte-1usy634"),attr(s,"class",u=null_to_empty(l[1].children.length>l[3]+1?"active":"hidden")+" svelte-1usy634"),attr(e,"class","navbar svelte-1usy634")},m(_,d){insert_hydration(_,e,d),append_hydration(e,t),append_hydration(t,n),append_hydration(e,a),append_hydration(e,s),append_hydration(s,c),o||(r=[listen(t,"click",l[6]),listen(s,"click",l[7])],o=!0)},p(_,d){d&8&&i!==(i=null_to_empty(_[3]>0?"active":"hidden")+" svelte-1usy634")&&attr(t,"class",i),d&10&&u!==(u=null_to_empty(_[1].children.length>_[3]+1?"active":"hidden")+" svelte-1usy634")&&attr(s,"class",u)},d(_){_&&detach(e),o=!1,run_all(r)}}}function create_fragment$1(l){let e,t,n=l[1]&&create_if_block$1(l);return{c(){n&&n.c(),e=empty()},l(i){n&&n.l(i),e=empty()},m(i,a){n&&n.m(i,a),insert_hydration(i,e,a),t=!0},p(i,[a]){i[1]?n?(n.p(i,a),a&2&&transition_in(n,1)):(n=create_if_block$1(i),n.c(),transition_in(n,1),n.m(e.parentNode,e)):n&&(group_outros(),transition_out(n,1,1,()=>{n=null}),check_outros())},i(i){t||(transition_in(n),t=!0)},o(i){transition_out(n),t=!1},d(i){i&&detach(e),n&&n.d(i)}}}function instance$1($$self,$$props,$$invalidate){let $context_message_number,$node,$$unsubscribe_node=noop,$$subscribe_node=()=>($$unsubscribe_node(),$$unsubscribe_node=subscribe(node,l=>$$invalidate(1,$node=l)),node);component_subscribe($$self,context_message_number,l=>$$invalidate(9,$context_message_number=l)),$$self.$$.on_destroy.push(()=>$$unsubscribe_node());let{nodeId}=$$props,node=getNode(nodeId);$$subscribe_node();let old_child_count=$node?$node.children.length:0;var oldid=nodeId;let openchild=0;function get_history(l){l==null&&(l=node);let e=[get_store_value(l).message],t=get_store_value(l).parent;for(;t!=null&&e.length<$context_message_number;){let n=getNode(t);e=[get_store_value(n).message,...e],t=get_store_value(n).parent}return console.log(e),e}async function send(senderID){senderID==null&&(senderID=nodeId);let hist=get_history(getNode(senderID));console.log({hist});let childid=createNode({role:"assistant",content:""},senderID),child=getNode(childid),message=writable(get_store_value(child).message);if(message.subscribe(l=>{child.update(e=>({...e,message:l}))}),await chatCompletion({messages:hist},message),get_store_value(message).function_call){let fcall=get_store_value(message).function_call;if((fcall==null?void 0:fcall.name)=="eval"){let res,res_string="";childid=createNode({role:"function",name:"eval",content:res_string},childid);let function_node=getNode(childid);try{let conslog=function(...l){res_string+=l+`
`,console.log(res_string),console.log(child),function_node.update(e=>({...e,message:{...e.message,content:res_string}}))},call=JSON.parse(fcall.arguments),code=call.argument.replaceAll("console.log","conslog");res=eval(code),code.includes("conslog")&&await new Promise(l=>setTimeout(l,1e3)),res instanceof Promise&&(console.log("awaiting promise"),res=await res,res_string+=JSON.stringify(res)),console.log(res),res_string+=JSON.stringify(res)??"",function_node.update(l=>({...l,message:{...l.message,content:res_string}}))}catch(l){console.log(l),console.log(fcall.arguments);let e=String(l);console.log(e),res_string+=e,function_node.update(t=>({...t,message:{...t.message,content:res_string}}))}}send(childid)}else createNode({role:"user",content:""},childid)}onMount(()=>{node.subscribe(l=>{l.children.length>old_child_count?($$invalidate(3,openchild=0),console.log("child added",old_child_count),old_child_count=l.children.length):l.children.length<old_child_count&&(console.log("child removed"),$$invalidate(3,openchild=Math.max(0,openchild-1)),old_child_count=l.children.length)})});const click_handler=()=>{$$invalidate(3,openchild=Math.max(0,openchild-1))},click_handler_1=()=>{$$invalidate(3,openchild=Math.min($node.children.length-1,openchild+1))};return $$self.$$set=l=>{"nodeId"in l&&$$invalidate(0,nodeId=l.nodeId)},$$self.$$.update=()=>{$$self.$$.dirty&35&&nodeId!=oldid&&($$subscribe_node($$invalidate(2,node=getNode(nodeId))),$$invalidate(5,oldid=nodeId),old_child_count=$node.children.length,$$invalidate(3,openchild=0))},[nodeId,$node,node,openchild,send,oldid,click_handler,click_handler_1]}class ChatNode extends SvelteComponent{constructor(e){super(),init(this,e,instance$1,create_fragment$1,safe_not_equal,{nodeId:0})}}const _page_svelte_svelte_type_style_lang="";function create_if_block(l){let e,t;return e=new ChatNode({props:{nodeId:l[1][l[0]].starter_id}}),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,i){mount_component(e,n,i),t=!0},p(n,i){const a={};i&3&&(a.nodeId=n[1][n[0]].starter_id),e.$set(a)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}function create_fragment(l){let e,t,n="settings",i,a,s,c,u,o,r,_=l[0]!=null&&l[1][l[0]]&&create_if_block(l);return{c(){e=element("main"),t=element("a"),t.textContent=n,i=space(),_&&_.c(),a=space(),s=element("div"),c=element("button"),this.h()},l(d){e=claim_element(d,"MAIN",{class:!0});var f=children(e);t=claim_element(f,"A",{class:!0,href:!0,"data-svelte-h":!0}),get_svelte_dataset(t)!=="svelte-1jmuo4z"&&(t.textContent=n),i=claim_space(f),_&&_.l(f),a=claim_space(f),s=claim_element(f,"DIV",{class:!0});var m=children(s);c=claim_element(m,"BUTTON",{class:!0}),children(c).forEach(detach),m.forEach(detach),f.forEach(detach),this.h()},h(){attr(t,"class","headerlink svelte-bf632i"),attr(t,"href","/settings"),attr(c,"class","homebtn svelte-bf632i"),attr(s,"class","footer svelte-bf632i"),attr(e,"class","svelte-bf632i")},m(d,f){insert_hydration(d,e,f),append_hydration(e,t),append_hydration(e,i),_&&_.m(e,null),append_hydration(e,a),append_hydration(e,s),append_hydration(s,c),u=!0,o||(r=listen(c,"click",l[2]),o=!0)},p(d,[f]){d[0]!=null&&d[1][d[0]]?_?(_.p(d,f),f&3&&transition_in(_,1)):(_=create_if_block(d),_.c(),transition_in(_,1),_.m(e,a)):_&&(group_outros(),transition_out(_,1,1,()=>{_=null}),check_outros())},i(d){u||(transition_in(_),u=!0)},o(d){transition_out(_),u=!1},d(d){d&&detach(e),_&&_.d(),o=!1,r()}}}function instance(l,e,t){let n,i;component_subscribe(l,active_persona,s=>t(0,n=s)),component_subscribe(l,personas,s=>t(1,i=s));function a(){createNode({role:"user",content:""},i[n].starter_id)}return onMount(()=>{window.origin.includes("localhost")&&(document.title="LocalRing",console.log("local"))}),[n,i,a]}class Page extends SvelteComponent{constructor(e){super(),init(this,e,instance,create_fragment,safe_not_equal,{})}}export{Page as component};
